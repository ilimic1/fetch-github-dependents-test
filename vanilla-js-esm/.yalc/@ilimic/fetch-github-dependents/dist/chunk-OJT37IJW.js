import h from"axios";import{load as m}from"cheerio";var d=class{constructor(i,r,t){this.user=i;this.repo=r;this.stars=t}getUrl(){return`https://github.com/${this.user}/${this.repo}`}},x=/^[A-Za-z0-9-]+$/i,w=/^[A-Za-z0-9-_\.]+$/;async function b(n,i){let r=[],t,s=0;do{await new Promise(e=>setTimeout(e,s)),s=0;let a;try{a=await(await h.get(n)).data}catch(e){if(e.response&&e.response.status===429){console.log("error.response.status",e.response.status),e.response.headers["retry-after"]&&/^[0-9]+$/.test(e.response.headers["retry-after"])?s=Number(e.response.headers["retry-after"])*1e3:s=5*60*1e3,console.log(`Got HTTP 429 Too Many Requests, sleeping for ${s/1e3} seconds...`);continue}return console.log("error.message",e.message),{repos:r,count:t}}let o=m(a);t===void 0&&(t=Number(o("svg.octicon-code-square").parent().text().replace(/[^0-9]/g,"")));let g=o('[data-test-id="dg-repo-pkg-dependent"]');for(let e=0;e<g.length;e++){let u=g[e],c=o(u).find('a[data-hovercard-type="user"],a[data-hovercard-type="organization"]').eq(0).text(),p=o(u).find('a[data-hovercard-type="repository"]').eq(0).text(),f=o(u).find("svg.octicon-star").parent().text();if((c===""||p==="")&&console.error(`Failed to get user and/or repo for repo ${c}/${p}.`),r.push(new d(c,p,Number(f))),i!==void 0&&r.length>=i)return console.log(`Went through ${r.length}/${t} repos...`),{repos:r,count:t}}let l=o('.paginate-container .btn.BtnGroup-item:contains("Next")').eq(0);n=l.length?l.attr("href"):null,console.log(`Went through ${r.length}/${t} repos...`)}while(n);return{repos:r,count:t}}async function q(n,i=void 0,r){let{repos:t,count:s}=await b(n,i);return r==="desc"?t.sort((a,o)=>o.stars-a.stars):r==="asc"&&t.sort((a,o)=>a.stars-o.stars),{repos:t,count:s}}export{x as a,w as b,q as c};
//# sourceMappingURL=chunk-OJT37IJW.js.map